<!-- templates/test.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login & Profile Demo</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f9; margin:0; padding:2rem; }
    #container { max-width: 400px; margin:auto; background:white; padding:1.5rem; border-radius:8px;
                 box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    h2 { margin-top:0; }
    label { display:block; margin-top:1rem; }
    input { width:100%; padding:.5rem; margin-top:.25rem; box-sizing:border-box; }
    button { margin-top:1rem; padding:.6rem 1.2rem; background:#4a90e2; color:white; border:none;
             border-radius:4px; cursor:pointer; }
    button:hover { background:#357abd; }
    #error { color:#b00020; margin-top:1rem; }
    #profile { display:none; }
    .profile-img { width:120px; height:120px; object-fit:cover; border-radius:50%; border:2px solid #ddd; }
    .field { margin-top:1rem; }
    .field span { font-weight:bold; }
    #logout { background:#e24a4a; }
    #logout:hover { background:#ab3737; }
  </style>
</head>
<body>
  <div id="container">
    <!-- Login form -->
    <div id="login-form">
      <h2>Login</h2>
      <div id="error"></div>
      <label>Username
        <input type="text" id="username" autocomplete="username">
      </label>
      <label>Password
        <input type="password" id="password" autocomplete="current-password">
      </label>
      <button id="btn-login">Log In</button>
    </div>

    <!-- Profile display -->
    <div id="profile">
      <h2>Your Profile</h2>
      <img id="profile-img" class="profile-img" src="" alt="Profile image">
      <div class="field"><span>ID:</span> <span id="profile-id"></span></div>
      <div class="field"><span>First Name:</span> <span id="profile-first"></span></div>
      <div class="field"><span>Last Name:</span> <span id="profile-last"></span></div>
      <div class="field"><span>Email:</span> <span id="profile-email"></span></div>
      <button id="logout">Log Out</button>
    </div>
  </div>

  <script>
    const API_BASE = ''; // same origin
    let tokens = null;

    const loginForm = document.getElementById('login-form');
    const profileDiv = document.getElementById('profile');
    const errorDiv = document.getElementById('error');
    const btnLogin = document.getElementById('btn-login');
    const btnLogout = document.getElementById('logout');

    btnLogin.addEventListener('click', async () => {
      errorDiv.textContent = '';
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      try {
        const res = await fetch(API_BASE + '/login/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        if (!res.ok) throw await res.json();
        tokens = await res.json();   // { access, refresh }
        await loadProfile();
      } catch (err) {
        errorDiv.textContent = err.detail || 'Login failed';
      }
    });

    async function loadProfile() {
      const res = await fetch(API_BASE + '/profile/', {
        headers: { 'Authorization': 'Bearer ' + tokens.access }
      });
      if (!res.ok) {
        errorDiv.textContent = 'Failed to load profile';
        return;
      }
      const p = await res.json();
      document.getElementById('profile-id').textContent    = p.id;
      document.getElementById('profile-first').textContent = p.first_name;
      document.getElementById('profile-last').textContent  = p.last_name;
      document.getElementById('profile-email').textContent = p.email;
      document.getElementById('profile-img').src           = p.image;
      // switch views
      loginForm.style.display   = 'none';
      profileDiv.style.display  = 'block';
    }

    btnLogout.addEventListener('click', () => {
      tokens = null;
      loginForm.style.display   = 'block';
      profileDiv.style.display  = 'none';
      errorDiv.textContent      = '';
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
    });
  </script>
</body>
</html>
<a href=""></a>